---
title: Récolte de bois
toc: false
sql:
  recolte_departements_historique: ./data/recolte_departements_historique.csv
---

```js
import { select, table } from "@observablehq/inputs";
```

```js
import {createOptionsEChartsFromData} from "./components/graphHisto.js";
```

```sql id=liste_departements
/*Requête pour obtenir la liste des départements*/ 
SELECT DISTINCT Département as departements
FROM recolte_departements_historique
```

```sql id=liste_essences
/*Requête pour obtenir la liste des essences*/ 
SELECT DISTINCT Récolte as essences 
FROM recolte_departements_historique
```

```sql id=borne_annees
/*Requête pour obtenir la liste des années*/ 
SELECT 
  MIN(CAST(column_name AS INTEGER)) AS annee_min,
  MAX(CAST(column_name AS INTEGER)) AS annee_max
FROM (
  SELECT column_name
  FROM information_schema.columns
  WHERE table_name='recolte_departements_historique'
  AND column_name LIKE '____' -- 4 caractères
)
```

```js
/*Création de la liste des années à partir des bornes obtenues dans la requête*/ 
const { annee_min, annee_max } = borne_annees.toArray()[0];
const annees = Array.from(
  { length: annee_max - annee_min + 1 }, 
  (_, i) => (annee_min + i).toString()
);
```

```js
/*Mise en forme*/ 
const tab_departements = liste_departements.toArray();
const tab_essences = liste_essences.toArray();

```

```js
/*Mise en forme*/ 
const noms_departements = tab_departements.map(d => d.departements);
const noms_essences = tab_essences.map(d => d.essences);

```

```js
/*Affichage des 3 listes de paramètres dynamiques*/ 
const choix_liste_departements = view(Inputs.select(noms_departements, { label: "Liste des départements"}));
const choix_liste_essences = view(Inputs.select(noms_essences, { label: "Liste des essences"}));
const choix_list_annee = view(Inputs.select(annees, { label: "Choix de l'année"}));
```






```sql id=test
SELECT * 
FROM recolte_departements_historique 
WHERE Département=${choix_liste_departements} 
AND Récolte=${choix_liste_essences}
```

```js
const table_filtree = test.toArray();
```
```js
table_filtree
```


```js
function createEChartsFromData2(width, option) {
    // Initialiser le graphique ECharts
    const container = display(html`<div style="width: ${width}px; height:400px;"></div>`);
    const myChart = echarts.init(container);
    myChart.setOption(option);
    return container;
}
```


```js
const optionEUR = createOptionsEChartsFromData(test, width, "TIME_PERIOD");
```

</div>

<div class="grid grid-cols-2" style="grid-auto-rows: 504px;">
  <div class="card">
  <h1>Production aquacole - Europe à 27</h1>
  ${
    resize((width) => createEChartsFromData2(width, optionEUR))
  }
<center><span style="font-size: X-small;">Volume en tonnes équivalent poids vif (TLW)</span></center>
<center><i style="font-size: X-small;">Source: Eurostat fish_aq2a, fish_aq_q, fish_aq_qh</i></center>

  </div>
  <div class="card">
     <h1>Production aquacole en France</h1>
  ${
    resize((width) => createEChartsFromData2(width, optionFR))
  }
<center><span style="font-size: X-small;">Volume en tonnes équivalent poids vif (TLW)</span></center>
<center><i style="font-size: X-small;">Source: Eurostat fish_aq2a, fish_aq_q, fish_aq_qh</i></center>

  </div>
</div>
















